/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'java'
    id 'maven-publish'
}

repositories {
    mavenLocal()
    maven {
        url = uri('https://repo.maven.apache.org/maven2/')
    }
}

dependencies {
    implementation 'org.jolie-lang:jolie:1.10.4'
    implementation 'org.jolie-lang:libjolie:1.10.4'
    implementation 'org.mongodb:bson:4.2.3'
    implementation 'org.mongodb:mongodb-driver-core:4.2.3'
    implementation 'org.mongodb:mongodb-driver-sync:4.2.3'
    implementation 'org.slf4j:slf4j-api:1.7.30'
    runtimeOnly 'org.slf4j:slf4j-simple:1.7.30'
    testImplementation 'org.testng:testng:6.8.1'
}

group = 'io.github.szingaro'
description = 'Jolie MongoDB Driver'
java.sourceCompatibility = JavaVersion.VERSION_1_8

publishing {
    publications {
        maven(MavenPublication) {
            from(components.java)
        }
    }
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}

tasks.named('test') {
    useTestNG()
}

def jarOutputFolder = "dist"

version "0.3.6"

task setVersion {
    File file = projectDir.toPath().resolve("src/resources/project.properties" ).toFile();
    if( ! file.exists() ){
        file.createNewFile()
    }
    file.write "version=" + version
}
compileJava.dependsOn( setVersion )

task jarApplication( type: Jar ) {
    destinationDirectory = file( jarOutputFolder )
    manifest {
        attributes "Implementation-Title": "Jolie MongoDB Driver Application Implementation",
                "Implementation-Version": project.version,
                'Main-Class': 'org.jolie.driver.DriverService'
    }
    setDuplicatesStrategy( DuplicatesStrategy.WARN )
    archiveBaseName.set( "jolie-mongodb-driver" )
}

jar {
    enabled = false // this avoids creating an empty "project" jar file
    finalizedBy jarApplication
}

clean.doFirst{
    delete jarOutputFolder
}